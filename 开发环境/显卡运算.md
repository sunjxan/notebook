### Ubuntu

#### 安装Nvidia GPU驱动

1. 打开终端窗口，使用以下命令查看显卡信息和检查显卡正在使用的驱动程序，默认情况下开源nouveau驱动程序用于Nvidia卡；
```
sudo lshw -c display
```

2. 下载驱动程序（https://www.nvidia.com/Download/index.aspx?lang=cn）并安裝；

3. 删除旧的NVIDIA的驱动：
```
sudo apt-get purge nvidia*
sudo apt autoremove
```

4. 将系统自带的nouveau驱动屏蔽掉，代码如下：
```
# 打开系统黑名单
sudo vim /etc/modprobe.d/blacklist-nouveau.conf 
# 在末尾加入如下内容
blacklist nouveau
blacklist lbm-nouveau
options nouveau modeset=0
alias nouveau off
alias lbm-nouveau off

# 更新内核后重启
echo options nouveau modeset=0 | sudo tee -a /etc/modprobe.d/nouveau-kms.conf
sudo update-initramfs -u
sudo reboot

# 重启电脑后输入
lsmod | grep nouveau
# 没有任何输出说明禁用成功
```

5. 禁用主板的 Secure Boot 功能；

6. 安装驱动：
```
sudo sh NVIDIA-Linux-x86_64-440.44.run -no-opengl-files
# 忽略 pre-install script failed 信息
# 32位兼容 安装最好 选yes

nvidia-smi
# 正确输出信息即安装成功
```

#### 安装CUDA

https://developer.nvidia.com/cuda-downloads

```
# 要注意cuda没有向后兼容，应选择需要安装的深度学习框架支持的cuda版本，安装时不勾选Nvidia驱动
sudo sh cuda_10.1.243_418.87.00_linux.run

# 修改环境变量
sudo vim ~/.bashrc

# 追加
export CUDA_HOME="/usr/local/cuda"
export LD_LIBRARY_PATH="${CUDA_HOME}/lib64:$LD_LIBRARY_PATH"
export PATH="${CUDA_HOME}/bin:$PATH"

# 使配置生效
source ~/.bashrc

nvcc -V
```

#### 安装cuDNN

https://developer.nvidia.com/cudnn

```
cd /usr/local

sudo tar -xvf cudnn-10.1-linux-x64-v8.0.4.30.tgz

sudo chmod a+r /usr/local/cuda/include/cudnn.h /usr/local/cuda/lib64/libcudnn*
```

### WSL2

https://docs.microsoft.com/zh-cn/windows/win32/direct3d12/gpu-cuda-in-wsl

https://docs.nvidia.com/cuda/wsl-user-guide/index.html

1. 运行 Windows 10 **版本 20150** 或更高版本；
```
ver
```
2. 运行 WSL2 内核 **版本 4.19.121** 或更高版本；
```
cat /proc/version
```

3. 下载驱动程序（https://developer.nvidia.com/cuda/wsl/download）并安裝；

#### 安装CUDA

```
# 要注意cuda没有向后兼容，应选择需要安装的深度学习框架支持的cuda版本，安装时不勾选Nvidia驱动

# 添加Key
sudo apt-key adv --fetch-keys http://developer.download.nvidia.com/compute/cuda/repos/ubuntu1804/x86_64/7fa2af80.pub

# 添加仓库
echo "deb http://developer.download.nvidia.com/compute/cuda/repos/ubuntu1804/x86_64 /" | sudo tee /etc/apt/sources.list.d/cuda.list

sudo apt update && sudo apt install cuda-toolkit-10-1

# 修改环境变量
sudo vim ~/.bashrc

# 追加
export CUDA_HOME="/usr/local/cuda"
export LD_LIBRARY_PATH="${CUDA_HOME}/lib64:$LD_LIBRARY_PATH"
export PATH="${CUDA_HOME}/bin:$PATH"

nvcc -V

# 测试
cd /usr/local/cuda/samples/1_Utilities/deviceQuery
sudo make
./deviceQuery
# 结果显示为PASS表示通过

cd /usr/local/cuda/samples/4_Finance/BlackScholes
sudo make
./BlackScholes
```

